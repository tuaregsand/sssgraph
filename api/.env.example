# LaserStream API environment template (external/managed services)

PORT=3000

# Security baseline
# Keep true in production when using managed TLS-enabled services.
REQUIRE_SECURE_BACKENDS=true

# PostgreSQL (IDLS + agent tables)
DB_HOST=your-postgres-host.example.com
DB_PORT=5432
DB_USER=laserstream_app
DB_PASSWORD=replace-me
DB_NAME=laserstream
DB_SSLMODE=require
DB_SSLROOTCERT=
DB_SSLCERT=
DB_SSLKEY=
DB_TIMEZONE=UTC
DB_RUN_MIGRATIONS=true
DB_REQUIRE_SCHEMA=true

# Webhook signing + replay protection
WEBHOOK_SIGNING_ENABLED=true
WEBHOOK_SIGNING_SECRET=replace-with-long-random-secret
WEBHOOK_SIGNING_KEY_ID=laserstream-v1
WEBHOOK_SIGNATURE_TOLERANCE=5m
WEBHOOK_NONCE_TTL=10m

# ClickHouse (historical analytics)
CLICKHOUSE_HTTP_URL=https://your-clickhouse-host.example.com:8443
CLICKHOUSE_DATABASE=default
CLICKHOUSE_TABLE=solana_events
CLICKHOUSE_USER=default
CLICKHOUSE_PASSWORD=replace-me
CLICKHOUSE_TIMEOUT=5s

# Dragonfly / Redis (websocket fanout)
REDIS_ADDR=your-redis-host.example.com:6379
REDIS_PASSWORD=replace-me
REDIS_DB=0
REDIS_CHANNEL_PREFIX=events
REDIS_TLS=true
REDIS_TLS_SERVER_NAME=your-redis-host.example.com
REDIS_TLS_INSECURE_SKIP_VERIFY=false

# WebSocket behavior
WS_CLIENT_BUFFER=256
WS_PING_PERIOD=30s
WS_PONG_WAIT=60s
WS_WRITE_TIMEOUT=10s
WS_MAX_CONNECTIONS=20000
WS_MAX_CONNECTIONS_PER_IP=200

# Auth & authorization
AUTH_ENABLED=true
AUTH_ALLOW_PUBLIC_HEALTH=false
AUTH_JWT_HS256_SECRET=replace-with-long-random-secret-min-32-chars
# AUTH_API_KEYS format:
# key|subject|role|program1,program2;key2|subject2|admin|*
AUTH_API_KEYS=admin-key-change-me|platform-admin|admin|*;reader-key-change-me|analytics-agent|read|*

# Agent automations (metric monitors for AI agents)
AGENT_AUTOMATIONS_ENABLED=true
AGENT_AUTOMATIONS_POLL_INTERVAL=1m
AGENT_AUTOMATIONS_EVAL_TIMEOUT=10s
AGENT_AUTOMATIONS_WEBHOOK_TIMEOUT=5s
AGENT_AUTOMATION_AUDIT_RETENTION_ENABLED=true
AGENT_AUTOMATION_AUDIT_RETENTION=720h
AGENT_AUTOMATION_AUDIT_CLEANUP_INTERVAL=1h

# Rate limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_EVENTS_PER_MINUTE_PER_IP=120
RATE_LIMIT_WS_UPGRADES_PER_MINUTE_PER_IP=60

# Observability
METRICS_ENABLED=true
